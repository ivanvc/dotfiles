# Unbind defaults
bind index               \Cr        noop
bind index,pager         <Esc>b     noop
bind index,pager         <Esc>c     noop
bind index,pager         <Esc>d     noop
bind index,pager         <Esc>e     noop
bind index,pager         <Esc>i     noop
bind index,pager         <Esc>k     noop
bind index,pager         <Esc>l     noop
bind index,pager         <Esc>n     noop
bind index,pager         <Esc>p     noop
bind index,pager         <Esc>r     noop
bind index,pager         <Esc>s     noop
bind index,pager         <Esc>t     noop
bind index,pager         <Esc>u     noop
bind index,pager         <Esc>v     noop
bind index,pager         <Esc>C     noop
bind index,pager         <Esc>P     noop
bind index               <Esc><Tab> noop
bind index,pager         <Esc>V     noop
bind index,pager,generic <Esc>/     noop
bind index,pager         c          noop
bind index,pager         d          noop
bind index,pager,attach  g          noop
bind index,generic       n          noop
bind index,pager         s          noop
bind generic,pager       t          noop
bind index,pager         u          noop
bind generic             z          noop

bind generic,index,pager \Cf next-page
bind generic,index,pager \Cb previous-page
bind generic             gg  first-entry
bind generic,index       G   last-entry
bind generic,index,pager \Cd half-down
bind generic,index,pager \Cu half-up
bind generic             zt  current-top
bind generic             zz  current-middle
bind generic             zb  current-bottom

# some sane vim-like keybindings
bind  index       k        previous-entry
bind  index       j        next-entry
bind  index       K        previous-unread
bind  index       J        next-unread
bind  index       <Enter>  display-message
bind  index,pager n        search-next
bind  index,pager N        search-opposite
bind  index      \Cn       mail
bind  index      <Space>   collapse-thread
bind  index      za        collapse-thread
bind  index      zA        collapse-all
macro pager      za        "<exit><collapse-thread>" "collapse-thread"
bind index       <tab>     next-new-then-unread
bind index       <backtab> previous-new-then-unread

bind pager k  previous-line
bind pager j  next-line
bind pager K  previous-entry
bind pager J  next-entry

# Sidebar
macro index C "<enter-command> source ~/.mutt/ui-show-sidebar<enter>" "activate sidebar folder browser"

macro index,pager    gx  "<pipe-message>urlscan --compact --dedupe<Enter>"                "call urlscan to extract URLs out of a message"
macro attach,compose gx  "<pipe-entry>urlscan --compact --dedupe<Enter>"                  "call urlscan to extract URLs out of a message"

# global index and pager shortcuts
bind index,pager @ compose-to-sender
bind index,pager a group-reply
bind index,pager r reply
bind index,pager D purge-message
bind index m sync-mailbox
bind index h collapse-thread
bind index l collapse-thread
bind pager <Esc> exit

# Save all attachments
macro pager S "<pipe-message> ripmime -i - -d ~/Downloads && rm ~/Downloads/textfile*" "Save all non-text attachments using ripmime"
# Sync all email
macro index,pager O "<shell-escape>mbsync -a<enter>" "run mbsync to sync all mail"

macro index,pager y "<save-message><enter>" "move message to the archive"

macro generic,index,pager,attach,compose \Cr "<enter-command> source ~/.muttrc<enter>" "reload configuration"

# Calendar RSVPs
macro attach > "\
<enter-command>unset wait\_key<enter>\
<shell-escape>rm -rf /tmp/mutt-attachment<enter>\
<save-entry><kill-line>/tmp/mutt-attachment<enter>\
<shell-escape>~/.mutt/mutt-khal-rsvp.py -i -e 'iv@a.ki' /tmp/mutt-attachment<enter>"
